Kiwi.GameObjects.StatelessParticles=function(a,b,c,d,e,f){return Kiwi.Entity.call(this,a,c,d),f&&"Clock"===f.objType||(f=a.game.time.clock),this.constructor(a,b,c,d,e,f)},Kiwi.extend(Kiwi.GameObjects.StatelessParticles,Kiwi.Entity),function(){var a={constructor:function(a,b,c,d,e,f){var g;return this.config=this.buildDefaultConfig(),this._stageScale=new Kiwi.Geom.Point(1,1),this.dirty=!1,this._color0=new Kiwi.Utils.Color,this._color1=new Kiwi.Utils.Color,this._color2=new Kiwi.Utils.Color,this._color3=new Kiwi.Utils.Color,this._timer=null,this._deriveAngleTransformMatrix=new Kiwi.Geom.Matrix,this._deriveAngleOffsetMatrix=new Kiwi.Geom.Matrix,this.clock=f,this.randoms=function(){var a=[];for(g=0;5e3>g;g++)a.push(Math.random());return a}(),"undefined"==typeof c&&(c=0),"undefined"==typeof d&&(d=0),"undefined"!=typeof e&&this.mergeConfig(this.config,e),this.game.renderOption===Kiwi.RENDERER_WEBGL&&(this.glRenderer=this.game.renderer.requestRendererInstance("StatelessParticleRenderer",{config:this.config,gameObject:this})),"undefined"==typeof b?(console.error("A Texture Atlas was not passed when instantiating a new StatelessParticles."),this.visible=!1,void(this.active=!1)):(this.atlas=b,this.cellIndex=this.atlas.cellIndex,this.width=b.cells[0].w,this.height=b.cells[0].h,this.transform.rotPointX=0,this.transform.rotPointY=0,this.box=this.components.add(new Kiwi.Components.Box(this,c,d,this.width,this.height)),void(this.visible=!1))},setColor:function(a){var b,c=[];for(b in arguments)c[b]=arguments[b];switch(c=c.slice(1),a){case 0:this._color0.set.apply(this._color0,c),this.setConfigProp("colEnv0",[this._color0.r,this._color0.g,this._color0.b],!0),this.setConfigProp("alphaGradient",[this._color0.a,this.config.alphaGradient[1],this.config.alphaGradient[2],this.config.alphaGradient[3]],!0);break;case 1:this._color1.set.apply(this._color1,c),this.setConfigProp("colEnv1",[this._color1.r,this._color1.g,this._color1.b],!0),this.setConfigProp("alphaGradient",[this.configalphaGradient[0],this._color1.a,this.config.alphaGradient[2],this.config.alphaGradient[3]],!0);break;case 2:this._color2.set.apply(this._color2,c),this.setConfigProp("colEnv2",[this._color2.r,this._color2.g,this._color2.b],!0),this.setConfigProp("alphaGradient",[this.config.alphaGradient[0],this.config.alphaGradient[1],this._color2.a,this.config.alphaGradient[3]],!0);break;case 3:this._color3.set.apply(this._color3,c),this.setConfigProp("colEnv3",[this._color3.r,this._color3.g,this._color3.b],!0),this.setConfigProp("alphaGradient",[this.config.alphaGradient[0],this.config.alphaGradient[1],this.config.alphaGradient[2],this._color3.a],!0)}},getColor:function(a){switch(a){case 1:return this._color1.set(this.config.colEnv1[0],this.config.colEnv1[1],this.config.colEnv1[2],this.config.alphaGradient[1]),this._color1;case 2:return this._color2.set(this.config.colEnv2[0],this.config.colEnv2[1],this.config.colEnv2[2],this.config.alphaGradient[2]),this._color2;case 3:return this._color3.set(this.config.colEnv3[0],this.config.colEnv3[1],this.config.colEnv3[2],this.config.alphaGradient[3]),this._color3;default:return this._color0.set(this.config.colEnv0[0],this.config.colEnv0[1],this.config.colEnv0[2],this.config.alphaGradient[0]),this._color0}},buildDefaultConfig:function(){return{additive:!1,alpha:1,alphaGradient:[1,1,1,0],alphaStops:[.3,.7],angStartMin:0,angStartMax:0,angVelocityConform:!1,numParts:20,colEnv0:[1,0,0],colEnv1:[1,1,0],colEnv2:[1,1,1],colEnv3:[0,0,0],colEnvKeyframes:[.5,.6],endSize:150,gravityX:0,gravityY:-50,loop:!0,maxLifespan:5,maxStartTime:6,maxVel:100,minLifespan:3,minStartTime:1,minVel:70,posAngle:0,posConstrainRadial:!0,posConstrainRect:!0,posHeight:100,posLength:100,posOffsetX:0,posOffsetY:0,posRadialStart:4.363323129985823,posRadialEnd:5.061454830783556,posRadius:50,posShape:"radial",posWidth:100,startSize:4,velAngle:0,velAngMin:-2,velAngMax:2,velConstrainRadial:!1,velConstrainRect:!1,velHeight:100,velLength:30,velOffsetX:0,velOffsetY:0,velRadialStart:0,velRadialEnd:6.283185307179586,velRadius:100,velShape:"line",velWidth:100}},mergeConfig:function(a,b){var c;for(c in b)a[c]=this.forceNumeric(b[c])},forceNumeric:function(a){var b,c;if("string"==typeof a&&(c=+a,!isNaN(c)))return c;if(Kiwi.Utils.Common.isArray(a))for(b in a)a[b]=this.forceNumeric(a[b]);return a},effectState:"stopped",objType:function(){return"StatelessParticles"},drawingVectors:[],useDrawingVectors:!1,rnd:null,randoms:[],useRandoms:!1,numRandoms:5e3,nextRandomIndex:-1,timeoutLength:0,nextRandom:function(){return this.nextRandomIndex++,this.nextRandomIndex>=this.numRandoms&&(this.nextRandomIndex=-1),this.randoms[this.nextRandomIndex]},startEmitting:function(a,b,c){"undefined"==typeof a&&(a=!0),"undefined"==typeof b&&(b=!1),"undefined"==typeof c&&(c=this.config.numParts),this.config.numParts=c,this.config.loop=a,this.glRenderer.resetTime(),this.glRenderer.resetPauseTime(),this.setConfig(this.config,!0,!0),!a&&b&&this.scheduleStop(1e3*this.timeoutLength,!0),this.effectState="started",this.visible=!0,this.clock.removeTimer(this._timer)},stopEmitting:function(a,b){"undefined"==typeof a&&(a=!1),"undefined"==typeof b&&(b=!1),"started"===this.effectState&&(a&&b?this.remove():a&&!b?(this.effectState="stopped",this.visible=!1):a||b?!a&&b&&(this.config.loop=!1,this.scheduleStop(1e3*this.timeoutLength,!0)):(this.glRenderer.pause(),this.effectState="stopping",this.scheduleStop(1e3*this.timeoutLength,!1)))},scheduleStop:function(a,b){var c=this;this.clock.removeTimer(this._timer),this._timer=this.clock.setTimeout(function(){c.effectState="stopped",c.visible=!1,b&&c.remove.call(c)},a)},remove:function(){this.glRenderer.destroy(),this.exists=!1},setConfig:function(a,b){this.config=a,this.glRenderer.setConfig(a),b&&this._generateParticles(),this.dirty=!0},setConfigProp:function(a,b,c,d){this.config[a]=b,this.setConfig(this.config,c,d)},getConfig:function(){return this.config},_generateParticles:function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q=this.config,r=[];for(this.nextRandomIndex=-1,this.drawingVectors=[],this.rnd=this.useRandoms?this.nextRandom:Math.random,f=0;f<q.numParts;f++){switch(j={x:0,y:0},k={x:0,y:0},n={x:q.velOffsetX,y:q.velOffsetY},p={x:0,y:0},q.posShape){case"radial":k=q.posRandomRadial?q.posConstrainRadial?this.randomPointCirclePerimeter(q.posRadialStart,q.posRadialEnd):this.randomPointCircle(q.posRadialStart,q.posRadialEnd):q.posConstrainRadial?this.regularPointCirclePerimeter(q.posRadialStart,q.posRadialEnd,f,q.numParts-1):this.randomPointCircle(q.posRadialStart,q.posRadialEnd),j.x=k.x*q.posRadius,j.y=k.y*q.posRadius;break;case"rectangle":k=q.posConstrainRect?this.randomPointRectPerimeter():this.randomPointRect(),j.x+=k.x*q.posWidth,j.y+=k.y*q.posHeight;break;case"line":k=q.posRandomLine?this.randomPointLine(q.posAngle):this.regularPointLine(q.posAngle,f,q.numParts-1),j.x+=k.x*q.posLength,j.y+=k.y*q.posLength;break;case"point":}switch(q.velShape){case"center":e=k,h=q.minVel+this.rnd()*(q.maxVel-q.minVel),n.x=e.x*h,n.y=e.y*h;break;case"radial":p=q.velRandomRadial?q.velConstrainRadial?this.randomPointCirclePerimeter(q.velRadialStart,q.velRadialEnd):this.randomPointCircle(q.velRadialStart,q.velRadialEnd):q.velConstrainRadial?this.regularPointCirclePerimeter(q.velRadialStart,q.velRadialEnd,f,q.numParts-1):this.randomPointCircle(q.velRadialStart,q.velRadialEnd),n.x+=p.x*q.velRadius,n.y+=p.y*q.velRadius;break;case"rectangle":p=q.velConstrainRect?this.randomPointRectPerimeter():this.randomPointRect(),n.x+=p.x*q.velWidth,n.y+=p.y*q.velHeight;break;case"line":p=q.velRandomLine?this.randomPointLine(q.velAngle):this.regularPointLine(q.velAngle,f,q.numParts-1),n.x+=p.x*q.velLength,n.y+=p.y*q.velLength;break;case"point":}d=Math.max(q.velAngMax,q.velAngMin)-Math.min(q.velAngMax,q.velAngMin),o=q.velAngMin+this.rnd()*d,a=Math.abs(q.angStartMax-q.angStartMin),l=q.angStartMin+this.rnd()*a,q.angVelocityConform&&(l+=Math.atan2(n.y,n.x)),j.x+=q.posOffsetX,j.y+=q.posOffsetY,r.push(j.x,j.y,n.x,n.y),this.drawingVectors.push({x:j.x,y:j.y,vx:n.x,vy:n.y}),m=q.minStartTime+this.rnd()*(q.maxStartTime-q.minStartTime),g=q.minLifespan+this.rnd()*(q.maxLifespan-q.minLifespan),this.timeoutLength=Math.max(this.timeoutLength,m+g),c=0,q.cells&&(i=q.cells.length,c=i>1?q.cells[Math.floor(this.rnd()*i)]:q.cells[0]),r.push(m,g,o,l),b=this.atlas.cells[c],r.push(b.x,b.y,b.w,b.h)}this.glRenderer.initBatch(r)},renderGL:function(a,b){var c,d,e,f=this.transform.getConcatenatedMatrix();this.dirty&&(this.dirty=!1,this.glRenderer.enableUniforms()),this.glRenderer.modelMatrix=f,this.glRenderer.setWorldAngle(this.deriveWorldAngle(this.transform,b)),this.glRenderer.setTextureUniforms(a,this.atlas),this.state.game.deviceTargetOption===Kiwi.TARGET_COCOON&&(this.state.game.stage.scaleType===Kiwi.Stage.SCALE_NONE?this._stageScale.setTo(1,1):this.state.game.stage.scaleType===Kiwi.Stage.SCALE_FIT?(c=this.state.game.stage.width/this.state.game.stage.height,d=window.innerWidth/window.innerHeight,d>c?(e=window.innerHeight/this.state.game.stage.height,this._stageScale.setTo(e,e)):(e=window.innerWidth/this.state.game.stage.width,this._stageScale.setTo(e,e))):this.state.game.stage.scaleType===Kiwi.Stage.SCALE_STRETCH&&(this._stageScale.x=window.innerWidth/this.state.game.stage.width,this._stageScale.y=window.innerHeight/this.state.game.stage.height)),this.glRenderer.stageScale.setTo(this._stageScale.x,this._stageScale.y)},deriveWorldAngle:function(a,b){var c,d,e=a.scaleX*b.transform.scaleX;return this._deriveAngleTransformMatrix.copyFrom(a.getConcatenatedMatrix()),c=this._deriveAngleTransformMatrix,c.prependMatrix(b.transform.getConcatenatedMatrix()),c.prependMatrix(this._deriveAngleOffsetMatrix.setTo(1,0,0,1,-b.transform.rotPointX,-b.transform.rotPointY)),d=Math.acos(c.a/e),Math.asin(c.b/e)<0&&(d*=-1),d},regularPointCirclePerimeter:function(a,b,c,d){var e=(b-a)/d*c+a;return{x:Math.cos(e),y:Math.sin(e)}},randomPointCirclePerimeter:function(a,b){var c=a+(b-a)*this.rnd();return{x:Math.cos(c),y:Math.sin(c)}},randomPointCircle:function(a,b){var c=a+(b-a)*this.rnd(),d=this.rnd()+this.rnd(),e=d>1?2-d:d;return{x:e*Math.cos(c),y:e*Math.sin(c)}},randomPointRect:function(){return{x:this.rnd()-.5,y:this.rnd()-.5}},randomPointRectPerimeter:function(){var a=4*this.rnd();return 1>a?{x:a-.5,y:-.5}:2>a?{x:.5,y:a-1.5}:3>a?{x:a-2.5,y:.5}:{x:-.5,y:a-3.5}},regularPointLine:function(a,b,c){var d=1/c*b-.5,e=d*Math.cos(a),f=d*Math.sin(a);return{x:e,y:f}},randomPointLine:function(a){var b=this.rnd()-.5,c=b*Math.cos(a),d=b*Math.sin(a);return{x:c,y:d}}};for(var b in a)Kiwi.GameObjects.StatelessParticles.prototype[b]=a[b]}(),Kiwi.Plugins.ParticlesGL={name:"ParticlesGL",version:"1.2.1",minimumKiwiVersion:"1.2.1",pluginDependencies:[]},Kiwi.PluginManager.register(Kiwi.Plugins.ParticlesGL),Kiwi.Renderers.StatelessParticleRenderer=function(a,b,c){Kiwi.Renderers.Renderer.call(this,a,b,!1,c),this.gl=a,this._config=c.config,this._gameObject=c.gameObject,this._stageScale=new Kiwi.Geom.Point(1,1),this._config||console.log("no particle configuration supplied"),this.vertexBuffer=new Kiwi.Renderers.GLArrayBuffer(a,12),this.shaderPair=this.shaderManager.requestShader(a,"StatelessParticleShader",!1),this.worldAngle=0,this.modelMatrix=new Kiwi.Geom.Matrix,this._camMatrix=new Kiwi.Geom.Matrix},Kiwi.extend(Kiwi.Renderers.StatelessParticleRenderer,Kiwi.Renderers.Renderer),Kiwi.Renderers.StatelessParticleRenderer.prototype.RENDERER_ID="StatelessParticleRenderer",Object.defineProperty(Kiwi.Renderers.StatelessParticleRenderer.prototype,"stageScale",{get:function(){return this._stageScale},set:function(a){this._stageScale=a}}),Kiwi.Renderers.StatelessParticleRenderer.prototype.setConfig=function(a){this._config=a,this.blendMode.setMode(a.additive?"ADDITIVE":"NORMAL")},Kiwi.Renderers.StatelessParticleRenderer.prototype.resetTime=function(){this.startTime=this._now()},Kiwi.Renderers.StatelessParticleRenderer.prototype.resetPauseTime=function(){this.pauseTime=999999999},Kiwi.Renderers.StatelessParticleRenderer.prototype.enable=function(a,b){this.shaderPair=this.shaderManager.requestShader(a,"StatelessParticleShader"),this._setStandardUniforms(a,b.stageResolution,b.camMatrix),this._setConfigUniforms(a)},Kiwi.Renderers.StatelessParticleRenderer.prototype.enableUniforms=function(a){this._setConfigUniforms(a)},Kiwi.Renderers.StatelessParticleRenderer.prototype._setStandardUniforms=function(a,b,c){a.uniform1i(this.shaderPair.uniforms.uSampler.location,0),a.uniformMatrix3fv(this.shaderPair.uniforms.uCamMatrix.location,!1,c),a.uniform2fv(this.shaderPair.uniforms.uResolution.location,b),this.camMatrix=new Float32Array(c.buffer)},Kiwi.Renderers.StatelessParticleRenderer.prototype._setConfigUniforms=function(a){var b,c=this._config;a=a||this.gl,b=new Float32Array([c.startSize*this._stageScale.x,c.endSize*this._stageScale.y]),a.uniform1f(this.shaderPair.uniforms.uAlpha.location,c.alpha),a.uniform4fv(this.shaderPair.uniforms.uAlphaGradient.location,new Float32Array(c.alphaGradient)),a.uniform2fv(this.shaderPair.uniforms.uAlphaStops.location,new Float32Array(c.alphaStops)),a.uniform3fv(this.shaderPair.uniforms.uColEnv0.location,new Float32Array(c.colEnv0)),a.uniform3fv(this.shaderPair.uniforms.uColEnv1.location,new Float32Array(c.colEnv1)),a.uniform3fv(this.shaderPair.uniforms.uColEnv2.location,new Float32Array(c.colEnv2)),a.uniform3fv(this.shaderPair.uniforms.uColEnv3.location,new Float32Array(c.colEnv3)),a.uniform2fv(this.shaderPair.uniforms.uColEnvKeyframes.location,new Float32Array(c.colEnvKeyframes)),a.uniform2fv(this.shaderPair.uniforms.uGravity.location,new Float32Array([c.gravityX,c.gravityY])),a.uniform1i(this.shaderPair.uniforms.uLoop.location,c.loop?1:0),a.uniform1f(this.shaderPair.uniforms.uPauseTime.location,this.pauseTime),a.uniform2fv(this.shaderPair.uniforms.uPointSizeRange.location,b),a.uniform1f(this.shaderPair.uniforms.uT.location,0)},Kiwi.Renderers.StatelessParticleRenderer.prototype.setTextureUniforms=function(a,b){a.uniform2fv(this.shaderPair.uniforms.uTextureSize.location,new Float32Array([b.image.width,b.image.height]))},Kiwi.Renderers.StatelessParticleRenderer.prototype.disable=function(a){a.disableVertexAttribArray(this.shaderPair.attributes.aXYVxVy),a.disableVertexAttribArray(this.shaderPair.attributes.aBirthLifespanAngle),a.disableVertexAttribArray(this.shaderPair.attributes.aCellXYWH)},Kiwi.Renderers.StatelessParticleRenderer.prototype.clear=function(){this.vertexBuffer.clear()},Kiwi.Renderers.StatelessParticleRenderer.prototype.time=0,Kiwi.Renderers.StatelessParticleRenderer.prototype.pauseTime=999999999,Kiwi.Renderers.StatelessParticleRenderer.prototype.pause=function(a){a=a||this.gl,this.pauseTime=this.time},Kiwi.Renderers.StatelessParticleRenderer.prototype.setWorldAngle=function(a){this.worldAngle=a},Kiwi.Renderers.StatelessParticleRenderer.prototype.draw=function(a){this._camMatrix.setTo(this.camMatrix[0],this.camMatrix[1],this.camMatrix[3],this.camMatrix[4],this.camMatrix[6],this.camMatrix[7]),this._camMatrix.appendMatrix(this.modelMatrix),a.uniformMatrix3fv(this.shaderPair.uniforms.uCamMatrix.location,!1,new Float32Array([this._camMatrix.a,this._camMatrix.b,0,this._camMatrix.c,this._camMatrix.d,0,this._camMatrix.tx,this._camMatrix.ty,1])),this.time=this._now()-this.startTime,a.uniform1f(this.shaderPair.uniforms.uT.location,this.time),a.uniform1f(this.shaderPair.uniforms.uWorldAngle.location,this.worldAngle),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer.buffer),a.enableVertexAttribArray(this.shaderPair.attributes.aXYVxVy),a.vertexAttribPointer(this.shaderPair.attributes.aXYVxVy,4,a.FLOAT,!1,48,0),a.enableVertexAttribArray(this.shaderPair.attributes.aBirthLifespanAngle),a.vertexAttribPointer(this.shaderPair.attributes.aBirthLifespanAngle,4,a.FLOAT,!1,48,16),a.enableVertexAttribArray(this.shaderPair.attributes.aCellXYWH),a.vertexAttribPointer(this.shaderPair.attributes.aCellXYWH,4,a.FLOAT,!1,48,32),a.drawArrays(a.POINTS,0,this._config.numParts)},Kiwi.Renderers.StatelessParticleRenderer.prototype.updateStageResolution=function(a,b){a.uniform2fv(this.shaderPair.uniforms.uResolution.location,b)},Kiwi.Renderers.StatelessParticleRenderer.prototype.updateTextureSize=function(a,b){a.uniform2fv(this.shaderPair.uniforms.uTextureSize.location,b)},Kiwi.Renderers.StatelessParticleRenderer.prototype.initBatch=function(a){this.vertexBuffer.items=a,this.vertexBuffer.uploadBuffer(this.gl,this.vertexBuffer.items)},Kiwi.Renderers.StatelessParticleRenderer.prototype._now=function(){return this._gameObject.clock.elapsed()},Kiwi.Renderers.StatelessParticleRenderer.prototype.destroy=function(a){a=a||this.gl,a.deleteBuffer(this.vertexBuffer.buffer)},Kiwi.Shaders.StatelessParticleShader=function(){Kiwi.Shaders.ShaderPair.call(this),this.attributes={aXYVxVy:null,aBirthLifespanAngle:null,aCellXYWH:null}},Kiwi.extend(Kiwi.Shaders.StatelessParticleShader,Kiwi.Shaders.ShaderPair),Kiwi.Shaders.StatelessParticleShader.prototype.init=function(a){Kiwi.Shaders.ShaderPair.prototype.init.call(this,a),this.attributes.aBirthLifespanAngle=a.getAttribLocation(this.shaderProgram,"aBirthLifespanAngle"),this.attributes.aCellXYWH=a.getAttribLocation(this.shaderProgram,"aCellXYWH"),this.attributes.aXYVxVy=a.getAttribLocation(this.shaderProgram,"aXYVxVy"),this.initUniforms(a)},Kiwi.Shaders.StatelessParticleShader.prototype.uniforms={uAlpha:{type:"1f"},uAlphaGradient:{type:"4fv"},uAlphaStops:{type:"2fv"},uCamMatrix:{type:"mat3"},uColEnv0:{type:"3fv"},uColEnv1:{type:"3fv"},uColEnv2:{type:"3fv"},uColEnv3:{type:"3fv"},uColEnvKeyframes:{type:"2fv"},uGravity:{type:"2fv"},uLoop:{type:"1i"},uPauseTime:{type:"1f"},uPointSizeRange:{type:"2fv"},uResolution:{type:"2fv"},uSampler:{type:"1i"},uT:{type:"1f"},uTextureSize:{type:"2fv"},uWorldAngle:{type:"1f"}},Kiwi.Shaders.StatelessParticleShader.prototype.fragSource=["precision mediump float;","uniform sampler2D uSampler;","varying vec4 vCol;","varying mat4 vRotationMatrix;","varying vec4 vCell;","void main( void ) {","	vec2 cellCoord = vCell.xy + vCell.zw * gl_PointCoord;","	vec2 texCoord = ( vRotationMatrix * vec4( cellCoord, 0, 1 ) ).xy;","	vec4 sampleCol = texture2D( uSampler, texCoord );","	gl_FragColor.rgb = vCol.rgb * sampleCol.rgb;","	gl_FragColor.a = sampleCol.a * vCol.a;","}"],Kiwi.Shaders.StatelessParticleShader.prototype.vertSource=["precision mediump float;","attribute vec4 aXYVxVy;","attribute vec4 aBirthLifespanAngle;","attribute vec4 aCellXYWH;","uniform mat3 uCamMatrix;","uniform vec2 uTextureSize;","uniform vec2 uResolution;","uniform float uT;","uniform float uPauseTime;","uniform vec2 uGravity;","uniform vec2 uPointSizeRange;","uniform vec3 uColEnv0;","uniform vec3 uColEnv1;","uniform vec3 uColEnv2;","uniform vec3 uColEnv3;","uniform vec2 uColEnvKeyframes;","uniform vec4 uAlphaGradient;","uniform vec2 uAlphaStops;","uniform float uWorldAngle;","uniform float uAlpha;","uniform bool uLoop;","varying vec4 vCol;","varying mat4 vRotationMatrix;","varying vec4 vCell;","vec3 deadPos = vec3( -0.02, -0.02, 0.01 );","void main(void) {","	float lerp;","	float birthTime = aBirthLifespanAngle.x;","	float lifespan = aBirthLifespanAngle.y;","	float angularVelocity = aBirthLifespanAngle.z;","	float angleStart = aBirthLifespanAngle.w;","	float deathTime = birthTime + lifespan;","	float age = mod(uT-birthTime,lifespan);","	float pauseTimeAge = mod(uPauseTime-birthTime,lifespan);","	float loopBirthTime = (uT - birthTime) / lifespan;","	if ( uT < birthTime || (uT >= deathTime && !uLoop ) ||","			(uT >= uPauseTime - pauseTimeAge + lifespan)) {","		gl_Position = vec4(deadPos.x,deadPos.y,0,0);","		gl_PointSize = deadPos.z;","	} else {","		lerp =  age / lifespan;","		gl_PointSize = mix( uPointSizeRange.x, uPointSizeRange.y, lerp );","		vec2 pos = aXYVxVy.xy;","		vec2 vel = aXYVxVy.zw;","		pos += age * vel;","		pos += 0.5 * uGravity * age * age;","		pos = ( uCamMatrix * vec3( pos, 1.0 ) ).xy;","		pos = ( pos / uResolution ) * 2.0 - 1.0;","		gl_Position = vec4( pos * vec2( 1, -1 ), 0, 1 );","		float colLerp = 1.0;","		if ( lerp <= uColEnvKeyframes.x ) {","			float cLerp = lerp / uColEnvKeyframes.x;","			vCol = vec4( mix( uColEnv0, uColEnv1, cLerp ), 1.0 );","		} else if ( lerp > uColEnvKeyframes.x &&","				lerp <= uColEnvKeyframes.y ) {","			float cLerp = ( lerp - uColEnvKeyframes.x ) /","				( uColEnvKeyframes.y - uColEnvKeyframes.x );","			vCol = vec4( mix( uColEnv1, uColEnv2, cLerp ), 1.0 );","		} else {","			float cLerp = ( lerp - uColEnvKeyframes.y ) /","				( 1.0 - uColEnvKeyframes.y );","			vCol = vec4( mix( uColEnv2, uColEnv3, cLerp ), 1.0 );","		}","		if (lerp <= uAlphaStops.x) {","			vCol.a = mix( uAlphaGradient.x, uAlphaGradient.y,","				lerp / uAlphaStops.x );","		} else if ( lerp > uAlphaStops.x && lerp <= uAlphaStops.y ) {","			vCol.a = mix( uAlphaGradient.y, uAlphaGradient.z,","				( lerp - uAlphaStops.x ) /","				( uAlphaStops.y - uAlphaStops.x ) );","		} else {","			vCol.a = mix( uAlphaGradient.z, uAlphaGradient.w,","				( lerp - uAlphaStops.y ) / ( 1.0 - uAlphaStops.y ) );","		}","		vCol.a *= uAlpha;","		float ang = age * angularVelocity + angleStart + uWorldAngle;","		vec2 ratio = vec2( 1.0 / uTextureSize.x, 1.0 / uTextureSize.y );","		vec4 normCell = aCellXYWH;","		normCell.xz *= ratio;","		normCell.yw *= ratio;","		vec2 cellCenter = vec2( normCell.x + normCell.z / 2.0,","			normCell.y + normCell.w / 2.0 );","		float c = cos( ang );","		float s = sin( ang );","		mat4 transInMat = mat4(","			1.0, 0.0, 0.0, 0.0,","			0.0, 1.0, 0.0, 0.0,","			0.0, 0.0, 1.0, 0.0,","			cellCenter.x, cellCenter.y, 0.0, 1.0 );","		mat4 rotMat = mat4(","			c, -s, 0.0, 0.0,","			s, c, 0.0, 0.0,","			0.0, 0.0, 1.0, 0.0,","			0.0, 0.0, 0.0, 1.0 );","		mat4 resultMat = transInMat * rotMat;","		resultMat[ 3 ][ 0 ] = resultMat[ 3 ][ 0 ] + resultMat[ 0 ][ 0 ] *","			-cellCenter.x + resultMat[ 1 ][ 0 ] * -cellCenter.y;","		resultMat[ 3 ][ 1 ] = resultMat[ 3 ][ 1 ] + resultMat[ 0 ][ 1 ] *","			-cellCenter.x + resultMat[ 1 ][ 1 ] * -cellCenter.y;","		resultMat[ 3 ][ 2 ] = resultMat[ 3 ][ 2 ] + resultMat[ 0 ][ 2 ] *","			-cellCenter.x + resultMat[ 1 ][ 2 ] * -cellCenter.y;","		vRotationMatrix = resultMat;","		vCell = normCell;","	} ","}"];